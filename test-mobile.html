<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест мобильного приложения</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .cart-counter { background: #007cba; color: white; padding: 10px; margin: 10px 0; }
        .quantity { margin: 10px 0; }
        .quantity input { width: 50px; padding: 5px; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; height: 200px; overflow-y: scroll; }
    </style>
</head>
<body>
    <h1>Тест счетчика корзины для мобильного приложения</h1>
    
    <div class="test-section">
        <h2>Эмуляция корзины</h2>
        <div class="cart-counter">
            <span class="w-cart-quantity">0</span> товаров в корзине
        </div>
        
        <div class="quantity">
            <label>Товар 1:</label>
            <input type="number" class="qty" value="0" min="0">
        </div>
        
        <div class="quantity">
            <label>Товар 2:</label>
            <input type="number" class="qty" value="0" min="0">
        </div>
        
        <div class="quantity">
            <label>Товар 3:</label>
            <input type="number" class="qty" value="0" min="0">
        </div>
    </div>
    
    <div class="test-section">
        <h2>Логи работы скрипта</h2>
        <div id="log" class="log"></div>
        <button onclick="clearLog()">Очистить логи</button>
    </div>
    
    <div class="test-section">
        <h2>Информация о браузере</h2>
        <div id="browser-info"></div>
    </div>

    <script>
        // Перехватываем console.log для отображения в интерфейсе
        const originalLog = console.log;
        const logDiv = document.getElementById('log');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = new Date().toLocaleTimeString() + ': ' + args.join(' ');
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        function clearLog() {
            logDiv.innerHTML = '';
        }
        
        // Информация о браузере
        document.getElementById('browser-info').innerHTML = `
            <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
            <p><strong>Платформа:</strong> ${navigator.platform}</p>
            <p><strong>Разрешение экрана:</strong> ${screen.width}x${screen.height}</p>
            <p><strong>Размер окна:</strong> ${window.innerWidth}x${window.innerHeight}</p>
            <p><strong>jQuery версия:</strong> ${jQuery.fn.jquery}</p>
            <p><strong>Время загрузки:</strong> ${new Date().toLocaleString()}</p>
        `;
        
        // Основной скрипт исправления счетчика корзины
        jQuery(document).ready(function($) {
            console.log('=== ЗАГРУЖЕН СКРИПТ ИСПРАВЛЕНИЯ СЧЕТЧИКА КОРЗИНЫ ===');
            console.log('Версия скрипта: ' + new Date().getTime());
            console.log('jQuery загружен: ' + (typeof $ !== 'undefined'));
            
            function updateCartCounter() {
                let total = 0;
                $('.quantity input.qty').each(function() {
                    const val = parseInt($(this).val()) || 0;
                    total += val;
                    console.log('Товар: ' + val + ' (общий: ' + total + ')');
                });
                
                $('.w-cart-quantity').html(total > 0 ? total : '0');
                $('.w-cart').each(function() {
                    $(this)[total > 0 ? 'removeClass' : 'addClass']('empty');
                });
                
                console.log('Счетчик корзины обновлен: ' + total);
                return total;
            }
            
            // Первоначальное обновление
            updateCartCounter();
            
            // Обновление каждые 2 секунды
            setInterval(function() {
                console.log('Автоматическое обновление счетчика (каждые 2 сек)');
                updateCartCounter();
            }, 2000);
            
            // Принудительное обновление для мобильных приложений
            setInterval(function() {
                console.log('Принудительное обновление для мобильных приложений (каждые 5 сек)');
                updateCartCounter();
            }, 5000);
            
            // Обновление при изменении количества
            $(document).on('change', '.quantity input.qty', function() {
                console.log('Изменение количества товара: ' + $(this).val());
                updateCartCounter();
            });
            
            $(document).on('click', '.quantity button', function() {
                console.log('Клик по кнопке количества');
                setTimeout(updateCartCounter, 100);
            });
            
            // Тест на мобильное устройство
            function isMobile() {
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }
            
            console.log('Мобильное устройство: ' + isMobile());
            console.log('=== СКРИПТ НАСТРОЕН И ГОТОВ К РАБОТЕ ===');
        });
    </script>
</body>
</html>
