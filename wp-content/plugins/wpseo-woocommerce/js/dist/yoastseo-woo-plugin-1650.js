(()=>{"use strict";const t=window.wp.data,e=window.wp.hooks,o=window.wp.i18n,n=window.lodash;function i(t){const e=document.querySelector(t+" a");e&&e.click()}function s(t,e={}){e=Object.assign({top:0,left:0},e);const o=t.getBoundingClientRect();window.scrollBy(o.left+e.left,o.top+e.top)}function a(t,e){t.classList.contains("open")||document.querySelectorAll(".edit_variation")[e].click()}let r=!0,c=!0,d=[];function u(t){return{id:t,sku:wpseoWooSKU.variations[t],productIdentifiers:wpseoWooIdentifiers.variations[t]}}function l(t){const e=[];return t.forEach((t=>{null===t?e.push(""):e.push(t.value)})),{gtin8:e[0].trim(),gtin12:e[1].trim(),gtin13:e[2].trim(),gtin14:e[3].trim(),isbn:e[4].trim(),mpn:e[5].trim()}}function p(t){const e=t.querySelector("input.variable_post_id").value,o=t.querySelector("input[id^=variable_sku]");let n="";o?n=o.value:r=!1;const i=[`#yoast_variation_identifier\\[${e}\\]\\[gtin8\\]`,`#yoast_variation_identifier\\[${e}\\]\\[gtin12\\]`,`#yoast_variation_identifier\\[${e}\\]\\[gtin13\\]`,`#yoast_variation_identifier\\[${e}\\]\\[gtin14\\]`,`#yoast_variation_identifier\\[${e}\\]\\[gtin14\\]`,`#yoast_variation_identifier\\[${e}\\]\\[mpn\\]`].map((e=>t.querySelector(e)));return i.some((t=>null===t))&&(c=!1),{id:e,sku:n.trim(),productIdentifiers:l(i)}}function f(){return function(t){const e=document.querySelector(".woocommerce_variations");if(0===t.length&&e){if(e.getAttribute("data-total")>0)return Object.keys(wpseoWooIdentifiers.variations).map(u);d=[]}else d=t<d?t:(0,n.uniqBy)([...t,...d,...Object.keys(wpseoWooIdentifiers.variations).map(u)],(t=>t.id));return d}([...document.querySelectorAll(".woocommerce_variation")].map(p))}function m(t){return Object.values(t.productIdentifiers).every((t=>""===t))}const y=function(t){const e=f();var o;"productSKU"!==t?"productIdentifier"===t&&(o=e.findIndex(m),i(".variations_tab"),setTimeout((()=>function(t){const e=document.querySelectorAll(".woocommerce_variation")[t];a(e,t);const o=e.querySelector("h1");setTimeout((()=>s(o,{top:-200})),200)}(o)),1e3)):function(t){i(".variations_tab"),setTimeout((()=>function(t){const e=document.querySelectorAll(".woocommerce_variation")[t];a(e,t);const o=e.querySelector("[id^='variable_sku']");o.focus(),s(o,{top:-200})}(t)),1e3)}(e.findIndex((t=>""===t.sku)))};function g(t){"productSKU"!==t&&"productIdentifier"!==t||(function(){const t=document.getElementById("woocommerce-product-data");t&&t.classList.contains("closed")&&t.querySelector(".handlediv").click()}(),"variable"===function(){let t=!0,e=!0,o="";const n=document.querySelector("input#_sku");n?o=n.value:t=!1;const i=["yoast_identifier_gtin8","yoast_identifier_gtin12","yoast_identifier_gtin13","yoast_identifier_gtin14","yoast_identifier_isbn","yoast_identifier_mpn"].map((t=>document.getElementById(t)));i.some((t=>null===t))&&(e=!1);const s=document.querySelector("select#product-type").value,a={canRetrieveGlobalSku:t,canRetrieveAllIdentifiers:e,sku:o.trim(),productType:s,productIdentifiers:l(i)};return Object.assign({},{sku:wpseoWooSKU.global_sku,productIdentifiers:wpseoWooIdentifiers.global_identifier_values},a)}().productType&&f().length>0?y(t):function(t){"productSKU"!==t?"productIdentifier"===t&&(i(".yoast_tab_tab"),s(document.getElementById("yoast_seo"),{top:-200})):function(){i(".inventory_tab");const t=document.getElementById("_sku");t.focus(),s(t,{top:-300})}()}(t))}const _="excerpt";function w(){return"undefined"!=typeof tinyMCE&&void 0!==tinyMCE.editors&&tinyMCE.editors.length>=0}function v(t){if(!w())return!1;const e=tinyMCE.get(t);return null!==e&&!e.isHidden()}function b(){return v(_)?tinyMCE.get(_).getContent():(t=_,document.getElementById(t)&&document.getElementById(t).value||"");var t}function h(t){const e=b();t.sendMessage("updateProductDescription",e,"YoastWooCommerce"),YoastSEO.app.refresh()}function S(t){const e=tinyMCE.get(_);e.on("change",(()=>h(t))),e.on("input",(()=>h(t)))}let E=0,k="";class I{constructor(){this.loadWorkerScript();const t=(0,n.get)(window,["wpseoWooL10n","jsTranslations","yoast-woo-seo","locale_data","yoast-woo-seo"],{"":{}});(0,o.setLocaleData)(t,"yoast-woo-seo"),YoastSEO.app.registerPlugin("YoastWooCommercePlugin",{status:"ready"}),this.registerModifications(),this.bindEvents(),this.dispatchGooglePreviewData(),(0,e.addFilter)("yoast.socials.imageFallback","yoast/yoast-woocommerce-seo/image_fallback",this.addProductGalleryImageAsFallback),(0,e.addAction)("yoast.focus.input","yoast/wpseo-woocommerce/inputFocus",g)}loadWorkerScript(){if("undefined"==typeof YoastSEO||void 0===YoastSEO.analysis||void 0===YoastSEO.analysis.worker)return;const t=YoastSEO.analysis.worker,e=b(),o="1"===wpseoWooL10n.shouldShowEditButtons;t.loadScript(wpseoWooL10n.script_url).then((()=>t.sendMessage("initialize",{productDescription:e,shouldShowEditButtons:o},"YoastWooCommerce"))).then(YoastSEO.app.refresh),t.initialize({translations:wpseoWooL10n.jsTranslations}),function(t){!function(t){const e=jQuery("#excerpt");e.on("change",(()=>h(t))),e.on("input",(()=>h(t)))}(t),v(_)&&S(t),w()&&tinyMCE.on("AddEditor",(e=>{"excerpt"===e.editor.id&&S(t)}))}(t)}bindEvents(){v("excerpt")&&tinyMCE.get("excerpt").on("change",(function(){YoastSEO.app.refresh()})),jQuery(".add_product_images").find("a").on("click",this.bindLinkEvent.bind(this)),this.bindDeleteEvent()}dispatchGooglePreviewData(){(0,t.dispatch)("yoast-seo/editor").setShoppingData(window.wpseoWooL10n.wooGooglePreviewData)}bindLinkEvent(){0===jQuery(".media-modal-content").find(".media-button").length?(E++,E<10&&setTimeout(this.bindLinkEvent.bind(this))):(E=0,jQuery(".media-modal-content").find(".media-button").on("click",this.buttonCallback.bind(this)))}buttonCallback(){YoastSEO.app.refresh()}bindDeleteEvent(){jQuery("#product_images_container").on("click",".delete",YoastSEO.app.refresh.bind(YoastSEO.app))}registerModifications(){const t=this.addContent.bind(this);YoastSEO.app.registerModification("content",t,"YoastWooCommercePlugin",10)}addContent(t){t+="\n\n"+b();const e=jQuery("#product_images_container").find("img");for(let o=0;o<e.length;o++)t+=e[o].outerHTML;return k=e[0]?e[0].src.replace(/-\d+x\d+(\.[a-zA-Z0-9]+)$/,"$1"):"",t}addProductGalleryImageAsFallback(t){if(k){const e=t.findIndex((t=>"socialImage"===Object.keys(t)[0]||"siteWideImage"===Object.keys(t)[0]));t.splice(e,0,{productGalleryImage:k})}return t}}"undefined"!=typeof YoastSEO&&void 0!==YoastSEO.app?new I:jQuery(window).on("YoastSEO:ready",(function(){new I}))})();